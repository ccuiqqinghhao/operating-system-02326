# 2.1 处理器

### 2.1.1 处理器的构成与基本工作方式

​		处理器一般由运算器、控制器、一系列寄存器以及高速缓存构成。

​			运算器实现指令中的算术和逻辑运算，是计算机的核心。

​			控制器控制程序运行流程

​			寄存器用于处理器执行指令的过程中暂存数据、地址及指令信息

​			高速缓存：为CPU和内存提供一个高速的数据缓存区域

##### 2.1.1.1 处理器中的控制器

​		控制程序运行的流程， 包括取指令、维护处理器状态、处理器与内存的交互等。

##### 2.1.1.2 处理器中的寄存器

* 用户可见寄存器

  ​	由编译程序分配，减少程序运行时访问内存的次数

  ​	一般包括数据寄存器（Data Register）、地址寄存器（Address Register）、条件码寄存器

* 控制和状态寄存器

  ​	用于·控制处理器的操作

  ​	常见包括程序计数器（PC）、指令寄存器（IR）、程序状态字（PSW）

##### 2.1.1.3 指令执行的基本过程

* 最简单的两个步骤
  1. 读取指令，并将程序计数器的值变成下一条指令的地址（通常为自增1）
  2. 指令放入指令寄存器，处理器解释并执行

* 指令的分类
  * 访问存储器指令： 负责处理器和存储器之间的数据传送
  * I/O指令： 负责处理器和I/O模块之间的数据传送和命令发送
  * 算数逻辑指令： 也称数据处理指令，用以执行有关数据的算术和逻辑操作
  * 控制转移指令： 指定一个新的指令的执行起点
  * 处理器控制指令： 用于修改处理器状态，高边处理器工作方式等

### 2.1.2 特权指令和非特权指令

> 多道程序环境中，指令分为特权指令和非特权指令

##### 2.1.2.1 特权指令

*  只能由系统使用
* 不允许一般用户使用
* 比如：设置程序状态字、启动某设备、设置终端屏蔽字等。

##### 2.1.2.2 非特权指令

* 普通用户使用的指令

### 2.1.3 处理器的工作状态

##### 2.1.3.1 管态和目态

* 管态：操作系统管理程序运行时的状态，又称内核态、系统态等，具有较高特权
* 目态：一般用户程序运行时的状态，又称用户态、普通态，具有较低特权

##### 2.1.3.2 处理器工作状态的转换

* 目态到管态

  ​		唯一途径是通过**中断**。中断响应时交换中断向量，新的中断向量的PSW的处理器状态标志为管态

* 管态到目态

  ​		可通过设置PSW指令，实现从操作系统到用户程序的转换

##### 2.1.3.3 限制用户程序执行特权指令

​		当用户程序执行时，如果取到了一条特权指令，则处理器拒绝执行该指令，并形成一个“非法操作”事件。然后操作系统通知用户程序--程序中有非法指令。

### 2.1.4 程序状态字（PSW）

> 为了解决处理器当前工作状态的问题，所有的处理器都有一些特殊寄存器，用以表明处理器当前的工作状态。用来指示处理器的寄存器，称为程序状态字。
>
> 比如CF：进位标志、ZF：结果为零标志

* CPU的工作状态代码

  > 指明当前的工作状态是管态还是目态

* 条件码

  > 反映指令执行后的结果特性，比如结果为0等。

* 中断屏蔽码

  > 支出是否允许中断